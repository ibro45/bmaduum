---
phase: 15-godoc-supporting-packages
plan: 03
type: execute
---

<objective>
Add comprehensive go doc comments to the internal/router, internal/state, and internal/config packages.

Purpose: Enable `go doc` to generate useful documentation for workflow routing, state persistence, and configuration loading.
Output: All exported types, interfaces, functions, and methods in all three packages have complete doc comments.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/CONVENTIONS.md
@.planning/phases/14-godoc-core-packages/14-01-SUMMARY.md

**Package overview:**

- `internal/router` - Workflow routing based on story status (already has good docs)
- Files: router.go (GetWorkflow), lifecycle.go (LifecycleStep, GetLifecycle)
- Current state: Well documented, minor enhancements needed

- `internal/state` - Lifecycle execution state persistence (already has good docs)
- Files: state.go (State, Manager)
- Current state: Good package doc, minor enhancements needed

- `internal/config` - Configuration loading via Viper
- Files: types.go (Config structs), config.go (Loader)
- Current state: Package doc exists, Config types need enhancement

**Go doc comment conventions (from Phase 14):**

- Package comment: First sentence is package summary
- Type/function comment: First sentence is one-line summary
- Reference related types with square brackets
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance internal/router package documentation</name>
  <files>internal/router/router.go, internal/router/lifecycle.go</files>
  <action>
In router.go, enhance the package doc:
- Keep one-line summary: "Package router provides workflow routing based on story status"
- Add brief overview: maps status values to workflow names, lifecycle step sequences
- List key types/functions: [GetWorkflow], [GetLifecycle], [LifecycleStep]

ErrStoryComplete:

- Enhance doc: sentinel error for done stories where no action needed
- Note usage: caller should skip the story, not treat as failure

ErrUnknownStatus:

- Enhance doc: sentinel error for unrecognized status values
- Note usage: caller should report error (likely YAML typo)

GetWorkflow:

- Document as the single-step workflow router
- Explain return values for each status
- Reference [status.Status] for valid values

In lifecycle.go:

LifecycleStep struct:

- Document as a single step in the lifecycle sequence
- Document Workflow field: the workflow name to execute
- Document NextStatus field: the status to set after completion

GetLifecycle:

- Document as the multi-step lifecycle router
- Explain that it returns the full sequence from current status to done
- Document error conditions
  </action>
  <verify>go doc ./internal/router shows package overview; go doc ./internal/router.GetLifecycle shows lifecycle routing documentation</verify>
  <done>All exported types and functions in internal/router have complete doc comments</done>
  </task>

<task type="auto">
  <name>Task 2: Enhance internal/state package documentation</name>
  <files>internal/state/state.go</files>
  <action>
Enhance the package doc:
- Keep one-line summary: "Package state provides lifecycle execution state persistence for resume functionality"
- Add overview: enables resuming failed lifecycle executions from the point of failure
- List key types: [State], [Manager]

StateFileName constant:

- Document as the filename used in working directory
- Note that it's a hidden file (.bmad-state.json)

ErrNoState:

- Document as sentinel error when no state file exists
- Note usage: caller should start fresh execution

State struct:

- Document as the persisted execution state
- Document each field:
  - StoryKey: the story being processed
  - StepIndex: the step that failed or is next
  - TotalSteps: total steps in the lifecycle
  - StartStatus: the status when execution began (for debugging)

Manager struct:

- Document as the state persistence handler
- Explain the directory-based approach for testability

NewManager:

- Document the dir parameter (working directory for state file)

Save method:

- Document as atomic state persistence
- Note the temp file + rename pattern for crash safety

Load method:

- Document as state retrieval
- Document the ErrNoState return case

Clear method:

- Document as state cleanup after successful completion
- Note that it's idempotent (no error if file doesn't exist)
  </action>
  <verify>go doc ./internal/state shows package overview with resume functionality; go doc ./internal/state.Manager shows all methods documented</verify>
  <done>All exported types and functions in internal/state have complete doc comments</done>
  </task>

<task type="auto">
  <name>Task 3: Enhance internal/config package documentation</name>
  <files>internal/config/types.go, internal/config/config.go</files>
  <action>
In types.go (which has the package doc), enhance:
- Keep one-line summary: "Package config provides configuration loading and management for bmad-automate"
- Add overview: Viper-based loading from YAML files and environment variables
- List key types: [Config], [Loader], [WorkflowConfig], [ClaudeConfig]

Config struct:

- Document as the root configuration container
- Document each field section:
  - Workflows: map of workflow name to prompt template
  - FullCycle: the steps for run/queue/epic commands
  - Claude: CLI binary configuration
  - Output: terminal output formatting options

WorkflowConfig struct:

- Document as a single workflow's configuration
- Document PromptTemplate field (Go template with {{.StoryKey}})

FullCycleConfig struct:

- Document as the lifecycle step sequence
- Document Steps field

ClaudeConfig struct:

- Document as Claude CLI configuration
- Document OutputFormat (stream-json) and BinaryPath fields

OutputConfig struct:

- Document as terminal output configuration
- Document TruncateLines and TruncateLength fields

DefaultConfig:

- Document as the default configuration factory
- Note that it provides sensible defaults for all fields

PromptData struct:

- Document as the data passed to workflow templates
- Document StoryKey field

In config.go:

Loader struct:

- Document as the Viper-based configuration loader

NewLoader:

- Document as the constructor

Load method:

- Document as the configuration loading entry point
- Document the priority order (env > config file > defaults)
- Document the BMAD\_ environment variable prefix
- Document the config file search paths

GetPrompt method:

- Document as the template expansion function
- Document the workflow name and PromptData parameters
- Note that it returns error if workflow not found
  </action>
  <verify>go doc ./internal/config shows package overview with Viper mention; go doc ./internal/config.Config shows all fields documented; go doc ./internal/config.Loader shows loading documentation</verify>
  <done>All exported types and functions in internal/config have complete doc comments</done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go doc ./internal/router` shows package overview with key functions
- [ ] `go doc ./internal/router.GetLifecycle` shows lifecycle routing documentation
- [ ] `go doc ./internal/state` shows resume functionality overview
- [ ] `go doc ./internal/state.Manager` shows all methods documented
- [ ] `go doc ./internal/config` shows Viper-based loading overview
- [ ] `go doc ./internal/config.Loader` shows Load method with priority order
- [ ] `golangci-lint run ./internal/router/... ./internal/state/... ./internal/config/...` passes
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- go doc output is informative and useful
- Doc comments follow Go conventions
- Phase 15 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/15-godoc-supporting-packages/15-03-SUMMARY.md`
</output>
