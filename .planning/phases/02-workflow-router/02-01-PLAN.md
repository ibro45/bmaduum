---
phase: 02-workflow-router
plan: 01
type: tdd
---

<objective>
Create routing logic that maps story status values to workflow names.

Purpose: Enable automatic workflow selection based on story status, eliminating manual workflow flag usage.
Output: Working, tested router package with GetWorkflow function.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:

@.planning/phases/01-sprint-status-reader/01-01-SUMMARY.md

# Key files from Phase 1:

@internal/status/types.go
@internal/status/reader.go

**Tech stack available:** gopkg.in/yaml.v3
**Established patterns:** table-driven-tests, yaml-struct-mapping

**Constraining decisions:**

- Phase 1: Status is a string type alias with 5 constants (backlog, ready-for-dev, in-progress, review, done)

**Workflow mapping (from PROJECT.md):**
| Status | Workflow |
|--------|----------|
| `backlog` | `create-story` |
| `ready-for-dev` | `dev-story` |
| `in-progress` | `dev-story` |
| `review` | `code-review` |
| `done` | (no workflow - story complete) |
</context>

<feature>
  <name>Status to Workflow Router</name>
  <files>internal/router/router.go, internal/router/router_test.go</files>
  <behavior>
    GetWorkflow(status.Status) returns (workflowName string, err error)

    Cases:
    - status.StatusBacklog → "create-story", nil
    - status.StatusReadyForDev → "dev-story", nil
    - status.StatusInProgress → "dev-story", nil
    - status.StatusReview → "code-review", nil
    - status.StatusDone → "", ErrStoryComplete (story done, no workflow needed)
    - invalid/unknown status → "", ErrUnknownStatus

    Error types:
    - ErrStoryComplete: sentinel error for done status (not a failure - story is complete)
    - ErrUnknownStatus: sentinel error for invalid/unknown status values

  </behavior>
  <implementation>
    Create internal/router package with:
    1. Sentinel errors (ErrStoryComplete, ErrUnknownStatus)
    2. GetWorkflow function using switch statement on status constants
    3. Return appropriate workflow name or error

    Follow existing patterns:
    - Package-level function (no struct needed for pure mapping)
    - Sentinel errors as package vars
    - Use status.Status type from internal/status

  </implementation>
</feature>

<verification>
go test ./internal/router/... -v
</verification>

<success_criteria>

- Failing tests written covering all status values and edge cases
- Implementation passes all tests
- Refactor complete (if needed)
- All 2-3 commits present (test, feat, optional refactor)
- `just test` passes
- `just lint` passes
  </success_criteria>

<output>
After completion, create `.planning/phases/02-workflow-router/02-01-SUMMARY.md` with:
- RED: What tests were written, why they failed
- GREEN: What implementation made them pass
- REFACTOR: What cleanup was done (if any)
- Commits: List of commits produced
</output>
