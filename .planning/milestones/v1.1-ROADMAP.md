# Milestone v1.1: Full Story Lifecycle

**Status:** SHIPPED 2026-01-09
**Phases:** 6-13
**Total Plans:** 11

## Overview

Run the complete story lifecycle (create→dev→review→commit) for each story before moving to the next, with error recovery, dry-run mode, and enhanced progress UI.

## Phases

### Phase 6: Lifecycle Definition

**Goal**: Define the full workflow sequence per status and status transitions
**Depends on**: v1.0 complete
**Plans**: 1 plan

Plans:

- [x] 06-01: Story Lifecycle Sequence (TDD) — completed 2026-01-08

**Details:**

- LifecycleStep struct with Workflow and NextStatus fields
- GetLifecycle function returning sequence from current status to done
- git-commit workflow added as final step after code-review

### Phase 7: Story Lifecycle Executor

**Goal**: New package that runs the complete workflow sequence for one story
**Depends on**: Phase 6
**Plans**: 2 plans

Plans:

- [x] 07-01: Status Writer (TDD) - Add UpdateStatus to status package — completed 2026-01-09
- [x] 07-02: Lifecycle Executor (TDD) - Orchestrate full story lifecycle — completed 2026-01-09

**Details:**

- New `lifecycle` package in `internal/lifecycle`
- Executor struct with WorkflowRunner, StatusReader, StatusWriter interfaces
- Execute function runs complete lifecycle from current status to done
- Fail-fast on workflow failure or status update failure

### Phase 8: Update Run Command

**Goal**: `run <story>` executes full lifecycle, not just one workflow
**Depends on**: Phase 7
**Plans**: 1 plan

Plans:

- [x] 08-01: Run command with lifecycle execution (TDD) — completed 2026-01-09

**Details:**

- Run command now executes complete lifecycle from current status to done
- App struct uses interfaces (WorkflowRunner, StatusReader, StatusWriter) for testability
- Status updated in sprint-status.yaml after each workflow

### Phase 9: Update Epic Command

**Goal**: Epic uses lifecycle executor, full cycle per story before moving to next
**Depends on**: Phase 8
**Plans**: 1 plan

Plans:

- [x] 09-01: Epic command with lifecycle execution (TDD) — completed 2026-01-09

**Details:**

- Epic command uses lifecycle executor
- Each story runs to completion before next story starts
- Maintains existing fail-fast behavior

### Phase 10: Update Queue Command

**Goal**: Queue also uses lifecycle executor for consistency
**Depends on**: Phase 9
**Plans**: 1 plan

Plans:

- [x] 10-01: Queue command with lifecycle execution (TDD) — completed 2026-01-09

**Details:**

- Queue command uses lifecycle executor
- Consistent behavior with epic and run commands

### Phase 11: Error Recovery & Resume

**Goal**: Save progress state when workflow fails, resume from failure point
**Depends on**: Phase 10
**Plans**: 1 plan

Plans:

- [x] 11-01: State Persistence (TDD) — completed 2026-01-09

**Details:**

- State struct for tracking lifecycle progress (StoryKey, StepIndex, TotalSteps, StartStatus)
- Save/Load/Clear/Exists functions for state persistence
- ErrNoState sentinel error for distinguishing missing file from read errors
- Atomic writes via temp file + rename

### Phase 12: Dry Run Mode

**Goal**: Preview what would happen without executing
**Depends on**: Phase 11
**Plans**: 2 plans

Plans:

- [x] 12-01: GetSteps Method (TDD) - Add GetSteps to lifecycle executor — completed 2026-01-09
- [x] 12-02: Dry Run Flags - Add --dry-run to run, queue, epic commands — completed 2026-01-09

**Details:**

- `--dry-run` flag for run, queue, epic commands
- Shows workflow sequence without executing
- Lists stories and their lifecycle steps

### Phase 13: Enhanced Progress UI

**Goal**: Better visibility into lifecycle progress
**Depends on**: Phase 12
**Plans**: 1 plan

Plans:

- [x] 13-01: Step Progress UI — completed 2026-01-09

**Details:**

- ProgressCallback type for external progress reporting
- SetProgressCallback method for optional callback injection
- Execute() calls callback before each workflow step with index/total/workflow
- Run command displays formatted step progress using existing Printer.StepStart

---

## Milestone Summary

**Key Decisions:**

- Interface-based DI for WorkflowRunner, StatusReader, StatusWriter (testability)
- Fail-fast on workflow failure or status update failure
- Manager pattern for state persistence (testable file operations)
- Atomic writes via temp file + rename for state files
- SetProgressCallback method instead of constructor injection (optional callback)

**Issues Resolved:**

- Stories now run complete lifecycle instead of single workflow
- Status updates persist automatically after each workflow step
- Error recovery via state file enables resume capability

**Issues Deferred:**

- None

**Technical Debt Incurred:**

- None

---

_For current project status, see .planning/ROADMAP.md_
